BEGIN
  INSERT INTO stok_obat (NAMA_OBAT, SATUAN, tanggal)
  SELECT NAMA_OBAT, SATUAN, DATE_FORMAT(NOW(),'%Y-%m-01')
  FROM stok_obat
WHERE tanggal >= LAST_DAY(NOW() - INTERVAL 2 MONTH) + INTERVAL 1 DAY
AND tanggal <= LAST_DAY(NOW() - INTERVAL 1 MONTH)
  GROUP BY NAMA_OBAT, SATUAN;
END